function t(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const e=globalThis,n=e.ShadowRoot&&(void 0===e.ShadyCSS||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),r=new WeakMap;let o=class{constructor(t,e,n){if(this._$cssResult$=!0,n!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(n&&void 0===t){const n=void 0!==e&&1===e.length;n&&(t=r.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&r.set(e,t))}return t}toString(){return this.cssText}};const s=t=>new o("string"==typeof t?t:t+"",void 0,i),a=(t,...e)=>{const n=1===t.length?t[0]:e.reduce((e,n,i)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[i+1],t[0]);return new o(n,t,i)},l=n?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return s(e)})(t):t,{is:h,defineProperty:c,getOwnPropertyDescriptor:u,getOwnPropertyNames:d,getOwnPropertySymbols:p,getPrototypeOf:f}=Object,g=globalThis,_=g.trustedTypes,v=_?_.emptyScript:"",y=g.reactiveElementPolyfillSupport,m=(t,e)=>t,$={toAttribute(t,e){switch(e){case Boolean:t=t?v:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},b=(t,e)=>!h(t,e),w={attribute:!0,type:String,converter:$,reflect:!1,useDefault:!1,hasChanged:b};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */Symbol.metadata??=Symbol("metadata"),g.litPropertyMetadata??=new WeakMap;let x=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=w){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(t,n,e);void 0!==i&&c(this.prototype,t,i)}}static getPropertyDescriptor(t,e,n){const{get:i,set:r}=u(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get:i,set(e){const o=i?.call(this);r?.call(this,e),this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??w}static _$Ei(){if(this.hasOwnProperty(m("elementProperties")))return;const t=f(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(m("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(m("properties"))){const t=this.properties,e=[...d(t),...p(t)];for(const n of e)this.createProperty(n,t[n])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,n]of e)this.elementProperties.set(t,n)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const n=this._$Eu(t,e);void 0!==n&&this._$Eh.set(n,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(l(t))}else void 0!==t&&e.push(l(t));return e}static _$Eu(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const n of e.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,i)=>{if(n)t.adoptedStyleSheets=i.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const n of i){const i=document.createElement("style"),r=e.litNonce;void 0!==r&&i.setAttribute("nonce",r),i.textContent=n.cssText,t.appendChild(i)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$ET(t,e){const n=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,n);if(void 0!==i&&!0===n.reflect){const r=(void 0!==n.converter?.toAttribute?n.converter:$).toAttribute(e,n.type);this._$Em=t,null==r?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(t,e){const n=this.constructor,i=n._$Eh.get(t);if(void 0!==i&&this._$Em!==i){const t=n.getPropertyOptions(i),r="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:$;this._$Em=i;const o=r.fromAttribute(e,t.type);this[i]=o??this._$Ej?.get(i)??o,this._$Em=null}}requestUpdate(t,e,n){if(void 0!==t){const i=this.constructor,r=this[t];if(n??=i.getPropertyOptions(t),!((n.hasChanged??b)(r,e)||n.useDefault&&n.reflect&&r===this._$Ej?.get(t)&&!this.hasAttribute(i._$Eu(t,n))))return;this.C(t,e,n)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,e,{useDefault:n,reflect:i,wrapped:r},o){n&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,o??e??this[t]),!0!==r||void 0!==o)||(this._$AL.has(t)||(this.hasUpdated||n||(e=void 0),this._$AL.set(t,e)),!0===i&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,n]of t){const{wrapped:t}=n,i=this[e];!0!==t||this._$AL.has(e)||void 0===i||this.C(e,void 0,n,i)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach(t=>t.hostUpdate?.()),this.update(e)):this._$EM()}catch(e){throw t=!1,this._$EM(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(t=>this._$ET(t,this[t])),this._$EM()}updated(t){}firstUpdated(t){}};x.elementStyles=[],x.shadowRootOptions={mode:"open"},x[m("elementProperties")]=new Map,x[m("finalized")]=new Map,y?.({ReactiveElement:x}),(g.reactiveElementVersions??=[]).push("2.1.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const M=globalThis,C=M.trustedTypes,A=C?C.createPolicy("lit-html",{createHTML:t=>t}):void 0,T="$lit$",E=`lit$${Math.random().toFixed(9).slice(2)}$`,k="?"+E,S=`<${k}>`,N=document,D=()=>N.createComment(""),U=t=>null===t||"object"!=typeof t&&"function"!=typeof t,L=Array.isArray,P="[ \t\n\f\r]",I=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,H=/-->/g,O=/>/g,R=RegExp(`>|${P}(?:([^\\s"'>=/]+)(${P}*=${P}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),F=/'/g,z=/"/g,j=/^(?:script|style|textarea|title)$/i,q=(t=>(e,...n)=>({_$litType$:t,strings:e,values:n}))(1),Y=Symbol.for("lit-noChange"),B=Symbol.for("lit-nothing"),V=new WeakMap,G=N.createTreeWalker(N,129);function W(t,e){if(!L(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==A?A.createHTML(e):e}const Z=(t,e)=>{const n=t.length-1,i=[];let r,o=2===e?"<svg>":3===e?"<math>":"",s=I;for(let e=0;e<n;e++){const n=t[e];let a,l,h=-1,c=0;for(;c<n.length&&(s.lastIndex=c,l=s.exec(n),null!==l);)c=s.lastIndex,s===I?"!--"===l[1]?s=H:void 0!==l[1]?s=O:void 0!==l[2]?(j.test(l[2])&&(r=RegExp("</"+l[2],"g")),s=R):void 0!==l[3]&&(s=R):s===R?">"===l[0]?(s=r??I,h=-1):void 0===l[1]?h=-2:(h=s.lastIndex-l[2].length,a=l[1],s=void 0===l[3]?R:'"'===l[3]?z:F):s===z||s===F?s=R:s===H||s===O?s=I:(s=R,r=void 0);const u=s===R&&t[e+1].startsWith("/>")?" ":"";o+=s===I?n+S:h>=0?(i.push(a),n.slice(0,h)+T+n.slice(h)+E+u):n+E+(-2===h?e:u)}return[W(t,o+(t[n]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),i]};class X{constructor({strings:t,_$litType$:e},n){let i;this.parts=[];let r=0,o=0;const s=t.length-1,a=this.parts,[l,h]=Z(t,e);if(this.el=X.createElement(l,n),G.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(i=G.nextNode())&&a.length<s;){if(1===i.nodeType){if(i.hasAttributes())for(const t of i.getAttributeNames())if(t.endsWith(T)){const e=h[o++],n=i.getAttribute(t).split(E),s=/([.?@])?(.*)/.exec(e);a.push({type:1,index:r,name:s[2],strings:n,ctor:"."===s[1]?et:"?"===s[1]?nt:"@"===s[1]?it:tt}),i.removeAttribute(t)}else t.startsWith(E)&&(a.push({type:6,index:r}),i.removeAttribute(t));if(j.test(i.tagName)){const t=i.textContent.split(E),e=t.length-1;if(e>0){i.textContent=C?C.emptyScript:"";for(let n=0;n<e;n++)i.append(t[n],D()),G.nextNode(),a.push({type:2,index:++r});i.append(t[e],D())}}}else if(8===i.nodeType)if(i.data===k)a.push({type:2,index:r});else{let t=-1;for(;-1!==(t=i.data.indexOf(E,t+1));)a.push({type:7,index:r}),t+=E.length-1}r++}}static createElement(t,e){const n=N.createElement("template");return n.innerHTML=t,n}}function J(t,e,n=t,i){if(e===Y)return e;let r=void 0!==i?n._$Co?.[i]:n._$Cl;const o=U(e)?void 0:e._$litDirective$;return r?.constructor!==o&&(r?._$AO?.(!1),void 0===o?r=void 0:(r=new o(t),r._$AT(t,n,i)),void 0!==i?(n._$Co??=[])[i]=r:n._$Cl=r),void 0!==r&&(e=J(t,r._$AS(t,e.values),r,i)),e}class Q{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:n}=this._$AD,i=(t?.creationScope??N).importNode(e,!0);G.currentNode=i;let r=G.nextNode(),o=0,s=0,a=n[0];for(;void 0!==a;){if(o===a.index){let e;2===a.type?e=new K(r,r.nextSibling,this,t):1===a.type?e=new a.ctor(r,a.name,a.strings,this,t):6===a.type&&(e=new rt(r,this,t)),this._$AV.push(e),a=n[++s]}o!==a?.index&&(r=G.nextNode(),o++)}return G.currentNode=N,i}p(t){let e=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class K{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,n,i){this.type=2,this._$AH=B,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=J(this,t,e),U(t)?t===B||null==t||""===t?(this._$AH!==B&&this._$AR(),this._$AH=B):t!==this._$AH&&t!==Y&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>L(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==B&&U(this._$AH)?this._$AA.nextSibling.data=t:this.T(N.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:n}=t,i="number"==typeof n?this._$AC(t):(void 0===n.el&&(n.el=X.createElement(W(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===i)this._$AH.p(e);else{const t=new Q(i,this),n=t.u(this.options);t.p(e),this.T(n),this._$AH=t}}_$AC(t){let e=V.get(t.strings);return void 0===e&&V.set(t.strings,e=new X(t)),e}k(t){L(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,i=0;for(const r of t)i===e.length?e.push(n=new K(this.O(D()),this.O(D()),this,this.options)):n=e[i],n._$AI(r),i++;i<e.length&&(this._$AR(n&&n._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class tt{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,n,i,r){this.type=1,this._$AH=B,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=B}_$AI(t,e=this,n,i){const r=this.strings;let o=!1;if(void 0===r)t=J(this,t,e,0),o=!U(t)||t!==this._$AH&&t!==Y,o&&(this._$AH=t);else{const i=t;let s,a;for(t=r[0],s=0;s<r.length-1;s++)a=J(this,i[n+s],e,s),a===Y&&(a=this._$AH[s]),o||=!U(a)||a!==this._$AH[s],a===B?t=B:t!==B&&(t+=(a??"")+r[s+1]),this._$AH[s]=a}o&&!i&&this.j(t)}j(t){t===B?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class et extends tt{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===B?void 0:t}}class nt extends tt{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==B)}}class it extends tt{constructor(t,e,n,i,r){super(t,e,n,i,r),this.type=5}_$AI(t,e=this){if((t=J(this,t,e,0)??B)===Y)return;const n=this._$AH,i=t===B&&n!==B||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,r=t!==B&&(n===B||i);i&&this.element.removeEventListener(this.name,this,n),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class rt{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){J(this,t)}}const ot=M.litHtmlPolyfillSupport;ot?.(X,K),(M.litHtmlVersions??=[]).push("3.3.1");const st=globalThis;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class at extends x{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,n)=>{const i=n?.renderBefore??e;let r=i._$litPart$;if(void 0===r){const t=n?.renderBefore??null;i._$litPart$=r=new K(e.insertBefore(D(),t),t,void 0,n??{})}return r._$AI(t),r})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Y}}at._$litElement$=!0,at.finalized=!0,st.litElementHydrateSupport?.({LitElement:at});const lt=st.litElementPolyfillSupport;lt?.({LitElement:at}),(st.litElementVersions??=[]).push("4.2.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ht=t=>(e,n)=>{void 0!==n?n.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)},ct={attribute:!0,type:String,converter:$,reflect:!1,hasChanged:b},ut=(t=ct,e,n)=>{const{kind:i,metadata:r}=n;let o=globalThis.litPropertyMetadata.get(r);if(void 0===o&&globalThis.litPropertyMetadata.set(r,o=new Map),"setter"===i&&((t=Object.create(t)).wrapped=!0),o.set(n.name,t),"accessor"===i){const{name:i}=n;return{set(n){const r=e.get.call(this);e.set.call(this,n),this.requestUpdate(i,r,t)},init(e){return void 0!==e&&this.C(i,void 0,t,e),e}}}if("setter"===i){const{name:i}=n;return function(n){const r=this[i];e.call(this,n),this.requestUpdate(i,r,t)}}throw Error("Unsupported decorator location: "+i)};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function dt(t){return(e,n)=>"object"==typeof n?ut(t,e,n):((t,e,n)=>{const i=e.hasOwnProperty(n);return e.constructor.createProperty(n,t),i?Object.getOwnPropertyDescriptor(e,n):void 0})(t,e,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function pt(t){return dt({...t,state:!0,attribute:!1})}function ft(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function gt(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function _t(t){let e,n,i;function r(t,i,r=0,o=t.length){if(r<o){if(0!==e(i,i))return o;do{const e=r+o>>>1;n(t[e],i)<0?r=e+1:o=e}while(r<o)}return r}return 2!==t.length?(e=ft,n=(e,n)=>ft(t(e),n),i=(e,n)=>t(e)-n):(e=t===ft||t===gt?t:vt,n=t,i=t),{left:r,center:function(t,e,n=0,o=t.length){const s=r(t,e,n,o-1);return s>n&&i(t[s-1],e)>-i(t[s],e)?s-1:s},right:function(t,i,r=0,o=t.length){if(r<o){if(0!==e(i,i))return o;do{const e=r+o>>>1;n(t[e],i)<=0?r=e+1:o=e}while(r<o)}return r}}}function vt(){return 0}const yt=_t(ft).right;function mt(t,e){let n,i;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=i=e):(n>e&&(n=e),i<e&&(i=e)));else{let r=-1;for(let o of t)null!=(o=e(o,++r,t))&&(void 0===n?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}_t(function(t){return null===t?NaN:+t}).center;const $t=Math.sqrt(50),bt=Math.sqrt(10),wt=Math.sqrt(2);function xt(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),s=o>=$t?10:o>=bt?5:o>=wt?2:1;let a,l,h;return r<0?(h=Math.pow(10,-r)/s,a=Math.round(t*h),l=Math.round(e*h),a/h<t&&++a,l/h>e&&--l,h=-h):(h=Math.pow(10,r)*s,a=Math.round(t/h),l=Math.round(e/h),a*h<t&&++a,l*h>e&&--l),l<a&&.5<=n&&n<2?xt(t,e,2*n):[a,l,h]}function Mt(t,e,n){return xt(t=+t,e=+e,n=+n)[2]}function Ct(t,e,n){n=+n;const i=(e=+e)<(t=+t),r=i?Mt(e,t,n):Mt(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function At(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Tt(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Et(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function kt(){}var St=.7,Nt=1/St,Dt="\\s*([+-]?\\d+)\\s*",Ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Lt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Pt=/^#([0-9a-f]{3,8})$/,It=new RegExp(`^rgb\\(${Dt},${Dt},${Dt}\\)$`),Ht=new RegExp(`^rgb\\(${Lt},${Lt},${Lt}\\)$`),Ot=new RegExp(`^rgba\\(${Dt},${Dt},${Dt},${Ut}\\)$`),Rt=new RegExp(`^rgba\\(${Lt},${Lt},${Lt},${Ut}\\)$`),Ft=new RegExp(`^hsl\\(${Ut},${Lt},${Lt}\\)$`),zt=new RegExp(`^hsla\\(${Ut},${Lt},${Lt},${Ut}\\)$`),jt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function qt(){return this.rgb().formatHex()}function Yt(){return this.rgb().formatRgb()}function Bt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Pt.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Vt(e):3===n?new Zt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Gt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Gt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=It.exec(t))?new Zt(e[1],e[2],e[3],1):(e=Ht.exec(t))?new Zt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ot.exec(t))?Gt(e[1],e[2],e[3],e[4]):(e=Rt.exec(t))?Gt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ft.exec(t))?ee(e[1],e[2]/100,e[3]/100,1):(e=zt.exec(t))?ee(e[1],e[2]/100,e[3]/100,e[4]):jt.hasOwnProperty(t)?Vt(jt[t]):"transparent"===t?new Zt(NaN,NaN,NaN,0):null}function Vt(t){return new Zt(t>>16&255,t>>8&255,255&t,1)}function Gt(t,e,n,i){return i<=0&&(t=e=n=NaN),new Zt(t,e,n,i)}function Wt(t,e,n,i){return 1===arguments.length?function(t){return t instanceof kt||(t=Bt(t)),t?new Zt((t=t.rgb()).r,t.g,t.b,t.opacity):new Zt}(t):new Zt(t,e,n,null==i?1:i)}function Zt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Xt(){return`#${te(this.r)}${te(this.g)}${te(this.b)}`}function Jt(){const t=Qt(this.opacity);return`${1===t?"rgb(":"rgba("}${Kt(this.r)}, ${Kt(this.g)}, ${Kt(this.b)}${1===t?")":`, ${t})`}`}function Qt(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Kt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function te(t){return((t=Kt(t))<16?"0":"")+t.toString(16)}function ee(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ie(t,e,n,i)}function ne(t){if(t instanceof ie)return new ie(t.h,t.s,t.l,t.opacity);if(t instanceof kt||(t=Bt(t)),!t)return new ie;if(t instanceof ie)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),o=Math.max(e,n,i),s=NaN,a=o-r,l=(o+r)/2;return a?(s=e===o?(n-i)/a+6*(n<i):n===o?(i-e)/a+2:(e-n)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new ie(s,a,l,t.opacity)}function ie(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function re(t){return(t=(t||0)%360)<0?t+360:t}function oe(t){return Math.max(0,Math.min(1,t||0))}function se(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Tt(kt,Bt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:qt,formatHex:qt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return ne(this).formatHsl()},formatRgb:Yt,toString:Yt}),Tt(Zt,Wt,Et(kt,{brighter(t){return t=null==t?Nt:Math.pow(Nt,t),new Zt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?St:Math.pow(St,t),new Zt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Zt(Kt(this.r),Kt(this.g),Kt(this.b),Qt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Xt,formatHex:Xt,formatHex8:function(){return`#${te(this.r)}${te(this.g)}${te(this.b)}${te(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Jt,toString:Jt})),Tt(ie,function(t,e,n,i){return 1===arguments.length?ne(t):new ie(t,e,n,null==i?1:i)},Et(kt,{brighter(t){return t=null==t?Nt:Math.pow(Nt,t),new ie(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?St:Math.pow(St,t),new ie(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Zt(se(t>=240?t-240:t+120,r,i),se(t,r,i),se(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new ie(re(this.h),oe(this.s),oe(this.l),Qt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Qt(this.opacity);return`${1===t?"hsl(":"hsla("}${re(this.h)}, ${100*oe(this.s)}%, ${100*oe(this.l)}%${1===t?")":`, ${t})`}`}}));var ae=t=>()=>t;function le(t){return 1===(t=+t)?he:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):ae(isNaN(e)?n:e)}}function he(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):ae(isNaN(t)?e:t)}var ce=function t(e){var n=le(e);function i(t,e){var i=n((t=Wt(t)).r,(e=Wt(e)).r),r=n(t.g,e.g),o=n(t.b,e.b),s=he(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=o(e),t.opacity=s(e),t+""}}return i.gamma=t,i}(1);function ue(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(o){for(n=0;n<i;++n)r[n]=t[n]*(1-o)+e[n]*o;return r}}function de(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,o=new Array(r),s=new Array(i);for(n=0;n<r;++n)o[n]=me(t[n],e[n]);for(;n<i;++n)s[n]=e[n];return function(t){for(n=0;n<r;++n)s[n]=o[n](t);return s}}function pe(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function fe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function ge(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=me(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}}var _e=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ve=new RegExp(_e.source,"g");function ye(t,e){var n,i,r,o=_e.lastIndex=ve.lastIndex=0,s=-1,a=[],l=[];for(t+="",e+="";(n=_e.exec(t))&&(i=ve.exec(e));)(r=i.index)>o&&(r=e.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:fe(n,i)})),o=ve.lastIndex;return o<e.length&&(r=e.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)a[(n=l[i]).i]=n.x(t);return a.join("")})}function me(t,e){var n,i=typeof e;return null==e||"boolean"===i?ae(e):("number"===i?fe:"string"===i?(n=Bt(e))?(e=n,ce):ye:e instanceof Bt?ce:e instanceof Date?pe:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(e)?ue:Array.isArray(e)?de:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?ge:fe)(t,e)}function $e(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function be(t){return+t}var we=[0,1];function xe(t){return t}function Me(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Ce(t,e,n){var i=t[0],r=t[1],o=e[0],s=e[1];return r<i?(i=Me(r,i),o=n(s,o)):(i=Me(i,r),o=n(o,s)),function(t){return o(i(t))}}function Ae(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),o=new Array(i),s=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<i;)r[s]=Me(t[s],t[s+1]),o[s]=n(e[s],e[s+1]);return function(e){var n=yt(t,e,1,i)-1;return o[n](r[n](e))}}function Te(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ee(){var t,e,n,i,r,o,s=we,a=we,l=me,h=xe;function c(){var t=Math.min(s.length,a.length);return h!==xe&&(h=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(s[0],s[t-1])),i=t>2?Ae:Ce,r=o=null,u}function u(e){return null==e||isNaN(e=+e)?n:(r||(r=i(s.map(t),a,l)))(t(h(e)))}return u.invert=function(n){return h(e((o||(o=i(a,s.map(t),fe)))(n)))},u.domain=function(t){return arguments.length?(s=Array.from(t,be),c()):s.slice()},u.range=function(t){return arguments.length?(a=Array.from(t),c()):a.slice()},u.rangeRound=function(t){return a=Array.from(t),l=$e,c()},u.clamp=function(t){return arguments.length?(h=!!t||xe,c()):h!==xe},u.interpolate=function(t){return arguments.length?(l=t,c()):l},u.unknown=function(t){return arguments.length?(n=t,u):n},function(n,i){return t=n,e=i,c()}}function ke(){return Ee()(xe,xe)}function Se(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Ne(t){return(t=Se(Math.abs(t)))?t[1]:NaN}var De,Ue=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Le(t){if(!(e=Ue.exec(t)))throw new Error("invalid format: "+t);var e;return new Pe({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Pe(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Ie(t,e){var n=Se(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}Le.prototype=Pe.prototype,Pe.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var He={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ie(100*t,e),r:Ie,s:function(t,e){var n=Se(t,e);if(!n)return t+"";var i=n[0],r=n[1],o=r-(De=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Se(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Oe(t){return t}var Re,Fe,ze,je=Array.prototype.map,qe=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ye(t){var e,n,i=void 0===t.grouping||void 0===t.thousands?Oe:(e=je.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,o=[],s=0,a=e[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),o.push(t.substring(r-=a,r+a)),!((l+=a+1)>i));)a=e[s=(s+1)%e.length];return o.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",s=void 0===t.decimal?".":t.decimal+"",a=void 0===t.numerals?Oe:function(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}(je.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",h=void 0===t.minus?"−":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function u(t){var e=(t=Le(t)).fill,n=t.align,u=t.sign,d=t.symbol,p=t.zero,f=t.width,g=t.comma,_=t.precision,v=t.trim,y=t.type;"n"===y?(g=!0,y="g"):He[y]||(void 0===_&&(_=12),v=!0,y="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var m="$"===d?r:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",$="$"===d?o:/[%p]/.test(y)?l:"",b=He[y],w=/[defgprs%]/.test(y);function x(t){var r,o,l,d=m,x=$;if("c"===y)x=b(t)+x,t="";else{var M=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),_),v&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),M&&0===+t&&"+"!==u&&(M=!1),d=(M?"("===u?u:h:"-"===u||"("===u?"":u)+d,x=("s"===y?qe[8+De/3]:"")+x+(M&&"("===u?")":""),w)for(r=-1,o=t.length;++r<o;)if(48>(l=t.charCodeAt(r))||l>57){x=(46===l?s+t.slice(r+1):t.slice(r))+x,t=t.slice(0,r);break}}g&&!p&&(t=i(t,1/0));var C=d.length+t.length+x.length,A=C<f?new Array(f-C+1).join(e):"";switch(g&&p&&(t=i(A+t,A.length?f-x.length:1/0),A=""),n){case"<":t=d+t+x+A;break;case"=":t=d+A+t+x;break;case"^":t=A.slice(0,C=A.length>>1)+d+t+x+A.slice(C);break;default:t=A+d+t+x}return a(t)}return _=void 0===_?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_)),x.toString=function(){return t+""},x}return{format:u,formatPrefix:function(t,e){var n=u(((t=Le(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(Ne(e)/3))),r=Math.pow(10,-i),o=qe[8+i/3];return function(t){return n(r*t)+o}}}}function Be(t,e,n,i){var r,o=Ct(t,e,n);switch((i=Le(null==i?",f":i)).type){case"s":var s=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ne(e)/3)))-Ne(Math.abs(t)))}(o,s))||(i.precision=r),ze(i,s);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ne(e)-Ne(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(t){return Math.max(0,-Ne(Math.abs(t)))}(o))||(i.precision=r-2*("%"===i.type))}return Fe(i)}function Ve(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){if(!((n=+n)>0))return[];if((t=+t)===(e=+e))return[t];const i=e<t,[r,o,s]=i?xt(e,t,n):xt(t,e,n);if(!(o>=r))return[];const a=o-r+1,l=new Array(a);if(i)if(s<0)for(let t=0;t<a;++t)l[t]=(o-t)/-s;else for(let t=0;t<a;++t)l[t]=(o-t)*s;else if(s<0)for(let t=0;t<a;++t)l[t]=(r+t)/-s;else for(let t=0;t<a;++t)l[t]=(r+t)*s;return l}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return Be(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r,o=e(),s=0,a=o.length-1,l=o[s],h=o[a],c=10;for(h<l&&(r=l,l=h,h=r,r=s,s=a,a=r);c-- >0;){if((r=Mt(l,h,n))===i)return o[s]=l,o[a]=h,e(o);if(r>0)l=Math.floor(l/r)*r,h=Math.ceil(h/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,h=Math.floor(h*r)/r}i=r}return t},t}function Ge(){var t=ke();return t.copy=function(){return Te(t,Ge())},At.apply(t,arguments),Ve(t)}Re=Ye({thousands:",",grouping:[3],currency:["$",""]}),Fe=Re.format,ze=Re.formatPrefix;const We=new Date,Ze=new Date;function Xe(t,e,n,i){function r(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return r.floor=e=>(t(e=new Date(+e)),e),r.ceil=n=>(t(n=new Date(n-1)),e(n,1),t(n),n),r.round=t=>{const e=r(t),n=r.ceil(t);return t-e<n-t?e:n},r.offset=(t,n)=>(e(t=new Date(+t),null==n?1:Math.floor(n)),t),r.range=(n,i,o)=>{const s=[];if(n=r.ceil(n),o=null==o?1:Math.floor(o),!(n<i&&o>0))return s;let a;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<i);return s},r.filter=n=>Xe(e=>{if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)},(t,i)=>{if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!n(t););else for(;--i>=0;)for(;e(t,1),!n(t););}),n&&(r.count=(e,i)=>(We.setTime(+e),Ze.setTime(+i),t(We),t(Ze),Math.floor(n(We,Ze))),r.every=t=>(t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(i?e=>i(e)%t===0:e=>r.count(0,e)%t===0):r:null)),r}const Je=Xe(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Je.every=t=>(t=Math.floor(t),isFinite(t)&&t>0?t>1?Xe(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):Je:null),Je.range;const Qe=1e3,Ke=6e4,tn=36e5,en=864e5,nn=6048e5,rn=2592e6,on=31536e6,sn=Xe(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Qe)},(t,e)=>(e-t)/Qe,t=>t.getUTCSeconds());sn.range;const an=Xe(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Qe)},(t,e)=>{t.setTime(+t+e*Ke)},(t,e)=>(e-t)/Ke,t=>t.getMinutes());an.range;const ln=Xe(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Ke)},(t,e)=>(e-t)/Ke,t=>t.getUTCMinutes());ln.range;const hn=Xe(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Qe-t.getMinutes()*Ke)},(t,e)=>{t.setTime(+t+e*tn)},(t,e)=>(e-t)/tn,t=>t.getHours());hn.range;const cn=Xe(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*tn)},(t,e)=>(e-t)/tn,t=>t.getUTCHours());cn.range;const un=Xe(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Ke)/en,t=>t.getDate()-1);un.range;const dn=Xe(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/en,t=>t.getUTCDate()-1);dn.range;const pn=Xe(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/en,t=>Math.floor(t/en));function fn(t){return Xe(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(t,e)=>{t.setDate(t.getDate()+7*e)},(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Ke)/nn)}pn.range;const gn=fn(0),_n=fn(1),vn=fn(2),yn=fn(3),mn=fn(4),$n=fn(5),bn=fn(6);function wn(t){return Xe(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+7*e)},(t,e)=>(e-t)/nn)}gn.range,_n.range,vn.range,yn.range,mn.range,$n.range,bn.range;const xn=wn(0),Mn=wn(1),Cn=wn(2),An=wn(3),Tn=wn(4),En=wn(5),kn=wn(6);xn.range,Mn.range,Cn.range,An.range,Tn.range,En.range,kn.range;const Sn=Xe(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear()),t=>t.getMonth());Sn.range;const Nn=Xe(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear()),t=>t.getUTCMonth());Nn.range;const Dn=Xe(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());Dn.every=t=>isFinite(t=Math.floor(t))&&t>0?Xe(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)}):null,Dn.range;const Un=Xe(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());Un.every=t=>isFinite(t=Math.floor(t))&&t>0?Xe(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)}):null,Un.range;const[Ln,Pn]=function(t,e,n,i,r,o){const s=[[sn,1,Qe],[sn,5,5e3],[sn,15,15e3],[sn,30,3e4],[o,1,Ke],[o,5,3e5],[o,15,9e5],[o,30,18e5],[r,1,tn],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,en],[i,2,1728e5],[n,1,nn],[e,1,rn],[e,3,7776e6],[t,1,on]];function a(e,n,i){const r=Math.abs(n-e)/i,o=_t(([,,t])=>t).right(s,r);if(o===s.length)return t.every(Ct(e/on,n/on,i));if(0===o)return Je.every(Math.max(Ct(e,n,i),1));const[a,l]=s[r/s[o-1][2]<s[o][2]/r?o-1:o];return a.every(l)}return[function(t,e,n){const i=e<t;i&&([t,e]=[e,t]);const r=n&&"function"==typeof n.range?n:a(t,e,n),o=r?r.range(t,+e+1):[];return i?o.reverse():o},a]}(Dn,Sn,gn,un,hn,an);function In(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Hn(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function On(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}var Rn,Fn,zn={"-":"",_:" ",0:"0"},jn=/^\s*\d+/,qn=/^%/,Yn=/[\\^$*+?|[\]().{}]/g;function Bn(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",o=r.length;return i+(o<n?new Array(n-o+1).join(e)+r:r)}function Vn(t){return t.replace(Yn,"\\$&")}function Gn(t){return new RegExp("^(?:"+t.map(Vn).join("|")+")","i")}function Wn(t){return new Map(t.map((t,e)=>[t.toLowerCase(),e]))}function Zn(t,e,n){var i=jn.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Xn(t,e,n){var i=jn.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function Jn(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function Qn(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function Kn(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function ti(t,e,n){var i=jn.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function ei(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function ni(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function ii(t,e,n){var i=jn.exec(e.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function ri(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function oi(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function si(t,e,n){var i=jn.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function ai(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function li(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function hi(t,e,n){var i=jn.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function ci(t,e,n){var i=jn.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function ui(t,e,n){var i=jn.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function di(t,e,n){var i=qn.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function pi(t,e,n){var i=jn.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function fi(t,e,n){var i=jn.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function gi(t,e){return Bn(t.getDate(),e,2)}function _i(t,e){return Bn(t.getHours(),e,2)}function vi(t,e){return Bn(t.getHours()%12||12,e,2)}function yi(t,e){return Bn(1+un.count(Dn(t),t),e,3)}function mi(t,e){return Bn(t.getMilliseconds(),e,3)}function $i(t,e){return mi(t,e)+"000"}function bi(t,e){return Bn(t.getMonth()+1,e,2)}function wi(t,e){return Bn(t.getMinutes(),e,2)}function xi(t,e){return Bn(t.getSeconds(),e,2)}function Mi(t){var e=t.getDay();return 0===e?7:e}function Ci(t,e){return Bn(gn.count(Dn(t)-1,t),e,2)}function Ai(t){var e=t.getDay();return e>=4||0===e?mn(t):mn.ceil(t)}function Ti(t,e){return t=Ai(t),Bn(mn.count(Dn(t),t)+(4===Dn(t).getDay()),e,2)}function Ei(t){return t.getDay()}function ki(t,e){return Bn(_n.count(Dn(t)-1,t),e,2)}function Si(t,e){return Bn(t.getFullYear()%100,e,2)}function Ni(t,e){return Bn((t=Ai(t)).getFullYear()%100,e,2)}function Di(t,e){return Bn(t.getFullYear()%1e4,e,4)}function Ui(t,e){var n=t.getDay();return Bn((t=n>=4||0===n?mn(t):mn.ceil(t)).getFullYear()%1e4,e,4)}function Li(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Bn(e/60|0,"0",2)+Bn(e%60,"0",2)}function Pi(t,e){return Bn(t.getUTCDate(),e,2)}function Ii(t,e){return Bn(t.getUTCHours(),e,2)}function Hi(t,e){return Bn(t.getUTCHours()%12||12,e,2)}function Oi(t,e){return Bn(1+dn.count(Un(t),t),e,3)}function Ri(t,e){return Bn(t.getUTCMilliseconds(),e,3)}function Fi(t,e){return Ri(t,e)+"000"}function zi(t,e){return Bn(t.getUTCMonth()+1,e,2)}function ji(t,e){return Bn(t.getUTCMinutes(),e,2)}function qi(t,e){return Bn(t.getUTCSeconds(),e,2)}function Yi(t){var e=t.getUTCDay();return 0===e?7:e}function Bi(t,e){return Bn(xn.count(Un(t)-1,t),e,2)}function Vi(t){var e=t.getUTCDay();return e>=4||0===e?Tn(t):Tn.ceil(t)}function Gi(t,e){return t=Vi(t),Bn(Tn.count(Un(t),t)+(4===Un(t).getUTCDay()),e,2)}function Wi(t){return t.getUTCDay()}function Zi(t,e){return Bn(Mn.count(Un(t)-1,t),e,2)}function Xi(t,e){return Bn(t.getUTCFullYear()%100,e,2)}function Ji(t,e){return Bn((t=Vi(t)).getUTCFullYear()%100,e,2)}function Qi(t,e){return Bn(t.getUTCFullYear()%1e4,e,4)}function Ki(t,e){var n=t.getUTCDay();return Bn((t=n>=4||0===n?Tn(t):Tn.ceil(t)).getUTCFullYear()%1e4,e,4)}function tr(){return"+0000"}function er(){return"%"}function nr(t){return+t}function ir(t){return Math.floor(+t/1e3)}function rr(t){return new Date(t)}function or(t){return t instanceof Date?+t:+new Date(+t)}function sr(t,e,n,i,r,o,s,a,l,h){var c=ke(),u=c.invert,d=c.domain,p=h(".%L"),f=h(":%S"),g=h("%I:%M"),_=h("%I %p"),v=h("%a %d"),y=h("%b %d"),m=h("%B"),$=h("%Y");function b(t){return(l(t)<t?p:a(t)<t?f:s(t)<t?g:o(t)<t?_:i(t)<t?r(t)<t?v:y:n(t)<t?m:$)(t)}return c.invert=function(t){return new Date(u(t))},c.domain=function(t){return arguments.length?d(Array.from(t,or)):d().map(rr)},c.ticks=function(e){var n=d();return t(n[0],n[n.length-1],null==e?10:e)},c.tickFormat=function(t,e){return null==e?b:h(e)},c.nice=function(t){var n=d();return t&&"function"==typeof t.range||(t=e(n[0],n[n.length-1],null==t?10:t)),t?d(function(t,e){var n,i=0,r=(t=t.slice()).length-1,o=t[i],s=t[r];return s<o&&(n=i,i=r,r=n,n=o,o=s,s=n),t[i]=e.floor(o),t[r]=e.ceil(s),t}(n,t)):c},c.copy=function(){return Te(c,sr(t,e,n,i,r,o,s,a,l,h))},c}function ar(){return At.apply(sr(Ln,Pn,Dn,Sn,gn,un,hn,an,sn,Fn).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}!function(t){Rn=function(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,o=t.days,s=t.shortDays,a=t.months,l=t.shortMonths,h=Gn(r),c=Wn(r),u=Gn(o),d=Wn(o),p=Gn(s),f=Wn(s),g=Gn(a),_=Wn(a),v=Gn(l),y=Wn(l),m={a:function(t){return s[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return a[t.getMonth()]},c:null,d:gi,e:gi,f:$i,g:Ni,G:Ui,H:_i,I:vi,j:yi,L:mi,m:bi,M:wi,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:nr,s:ir,S:xi,u:Mi,U:Ci,V:Ti,w:Ei,W:ki,x:null,X:null,y:Si,Y:Di,Z:Li,"%":er},$={a:function(t){return s[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return a[t.getUTCMonth()]},c:null,d:Pi,e:Pi,f:Fi,g:Ji,G:Ki,H:Ii,I:Hi,j:Oi,L:Ri,m:zi,M:ji,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:nr,s:ir,S:qi,u:Yi,U:Bi,V:Gi,w:Wi,W:Zi,x:null,X:null,y:Xi,Y:Qi,Z:tr,"%":er},b={a:function(t,e,n){var i=p.exec(e.slice(n));return i?(t.w=f.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(t,e,n){var i=u.exec(e.slice(n));return i?(t.w=d.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(t,e,n){var i=v.exec(e.slice(n));return i?(t.m=y.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(t,e,n){var i=g.exec(e.slice(n));return i?(t.m=_.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(t,n,i){return M(t,e,n,i)},d:oi,e:oi,f:ui,g:ei,G:ti,H:ai,I:ai,j:si,L:ci,m:ri,M:li,p:function(t,e,n){var i=h.exec(e.slice(n));return i?(t.p=c.get(i[0].toLowerCase()),n+i[0].length):-1},q:ii,Q:pi,s:fi,S:hi,u:Xn,U:Jn,V:Qn,w:Zn,W:Kn,x:function(t,e,i){return M(t,n,e,i)},X:function(t,e,n){return M(t,i,e,n)},y:ei,Y:ti,Z:ni,"%":di};function w(t,e){return function(n){var i,r,o,s=[],a=-1,l=0,h=t.length;for(n instanceof Date||(n=new Date(+n));++a<h;)37===t.charCodeAt(a)&&(s.push(t.slice(l,a)),null!=(r=zn[i=t.charAt(++a)])?i=t.charAt(++a):r="e"===i?" ":"0",(o=e[i])&&(i=o(n,r)),s.push(i),l=a+1);return s.push(t.slice(l,a)),s.join("")}}function x(t,e){return function(n){var i,r,o=On(1900,void 0,1);if(M(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(r=(i=Hn(On(o.y,0,1))).getUTCDay(),i=r>4||0===r?Mn.ceil(i):Mn(i),i=dn.offset(i,7*(o.V-1)),o.y=i.getUTCFullYear(),o.m=i.getUTCMonth(),o.d=i.getUTCDate()+(o.w+6)%7):(r=(i=In(On(o.y,0,1))).getDay(),i=r>4||0===r?_n.ceil(i):_n(i),i=un.offset(i,7*(o.V-1)),o.y=i.getFullYear(),o.m=i.getMonth(),o.d=i.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),r="Z"in o?Hn(On(o.y,0,1)).getUTCDay():In(On(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(r+5)%7:o.w+7*o.U-(r+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Hn(o)):In(o)}}function M(t,e,n,i){for(var r,o,s=0,a=e.length,l=n.length;s<a;){if(i>=l)return-1;if(37===(r=e.charCodeAt(s++))){if(r=e.charAt(s++),!(o=b[r in zn?e.charAt(s++):r])||(i=o(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return m.x=w(n,m),m.X=w(i,m),m.c=w(e,m),$.x=w(n,$),$.X=w(i,$),$.c=w(e,$),{format:function(t){var e=w(t+="",m);return e.toString=function(){return t},e},parse:function(t){var e=x(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",$);return e.toString=function(){return t},e},utcParse:function(t){var e=x(t+="",!0);return e.toString=function(){return t},e}}}(t),Fn=Rn.format,Rn.parse,Rn.utcFormat,Rn.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var lr="http://www.w3.org/1999/xhtml",hr={svg:"http://www.w3.org/2000/svg",xhtml:lr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function cr(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),hr.hasOwnProperty(e)?{space:hr[e],local:t}:t}function ur(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===lr&&e.documentElement.namespaceURI===lr?e.createElement(t):e.createElementNS(n,t)}}function dr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function pr(t){var e=cr(t);return(e.local?dr:ur)(e)}function fr(){}function gr(t){return null==t?fr:function(){return this.querySelector(t)}}function _r(){return[]}function vr(t){return function(){return function(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}(t.apply(this,arguments))}}function yr(t){return function(e){return e.matches(t)}}var mr=Array.prototype.find;function $r(){return this.firstElementChild}var br=Array.prototype.filter;function wr(){return Array.from(this.children)}function xr(t){return new Array(t.length)}function Mr(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function Cr(t,e,n,i,r,o){for(var s,a=0,l=e.length,h=o.length;a<h;++a)(s=e[a])?(s.__data__=o[a],i[a]=s):n[a]=new Mr(t,o[a]);for(;a<l;++a)(s=e[a])&&(r[a]=s)}function Ar(t,e,n,i,r,o,s){var a,l,h,c=new Map,u=e.length,d=o.length,p=new Array(u);for(a=0;a<u;++a)(l=e[a])&&(p[a]=h=s.call(l,l.__data__,a,e)+"",c.has(h)?r[a]=l:c.set(h,l));for(a=0;a<d;++a)h=s.call(t,o[a],a,o)+"",(l=c.get(h))?(i[a]=l,l.__data__=o[a],c.delete(h)):n[a]=new Mr(t,o[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(p[a])===l&&(r[a]=l)}function Tr(t){return t.__data__}function Er(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function kr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Sr(t){return function(){this.removeAttribute(t)}}function Nr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Dr(t,e){return function(){this.setAttribute(t,e)}}function Ur(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Lr(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Pr(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ir(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Hr(t){return function(){this.style.removeProperty(t)}}function Or(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Rr(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Fr(t){return function(){delete this[t]}}function zr(t,e){return function(){this[t]=e}}function jr(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function qr(t){return t.trim().split(/^|\s+/)}function Yr(t){return t.classList||new Br(t)}function Br(t){this._node=t,this._names=qr(t.getAttribute("class")||"")}function Vr(t,e){for(var n=Yr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Gr(t,e){for(var n=Yr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Wr(t){return function(){Vr(this,t)}}function Zr(t){return function(){Gr(this,t)}}function Xr(t,e){return function(){(e.apply(this,arguments)?Vr:Gr)(this,t)}}function Jr(){this.textContent=""}function Qr(t){return function(){this.textContent=t}}function Kr(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function to(){this.innerHTML=""}function eo(t){return function(){this.innerHTML=t}}function no(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function io(){this.nextSibling&&this.parentNode.appendChild(this)}function ro(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function oo(){return null}function so(){var t=this.parentNode;t&&t.removeChild(this)}function ao(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function lo(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ho(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function co(t,e,n){return function(){var i,r=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=e);this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function uo(t,e,n){var i=Ir(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function po(t,e){return function(){return uo(this,t,e)}}function fo(t,e){return function(){return uo(this,t,e.apply(this,arguments))}}Mr.prototype={constructor:Mr,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},Br.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var go=[null];function _o(t,e){this._groups=t,this._parents=e}function vo(t){return"string"==typeof t?new _o([[document.querySelector(t)]],[document.documentElement]):new _o([[t]],go)}function yo(t){return function(){return t}}_o.prototype={constructor:_o,select:function(t){"function"!=typeof t&&(t=gr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s,a=e[r],l=a.length,h=i[r]=new Array(l),c=0;c<l;++c)(o=a[c])&&(s=t.call(o,o.__data__,c,a))&&("__data__"in o&&(s.__data__=o.__data__),h[c]=s);return new _o(i,this._parents)},selectAll:function(t){t="function"==typeof t?vr(t):function(t){return null==t?_r:function(){return this.querySelectorAll(t)}}(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var s,a=e[o],l=a.length,h=0;h<l;++h)(s=a[h])&&(i.push(t.call(s,s.__data__,h,a)),r.push(s));return new _o(i,r)},selectChild:function(t){return this.select(null==t?$r:function(t){return function(){return mr.call(this.children,t)}}("function"==typeof t?t:yr(t)))},selectChildren:function(t){return this.selectAll(null==t?wr:function(t){return function(){return br.call(this.children,t)}}("function"==typeof t?t:yr(t)))},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s=e[r],a=s.length,l=i[r]=[],h=0;h<a;++h)(o=s[h])&&t.call(o,o.__data__,h,s)&&l.push(o);return new _o(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,Tr);var n=e?Ar:Cr,i=this._parents,r=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),h=0;h<o;++h){var c=i[h],u=r[h],d=u.length,p=Er(t.call(c,c&&c.__data__,h,i)),f=p.length,g=a[h]=new Array(f),_=s[h]=new Array(f);n(c,u,g,_,l[h]=new Array(d),p,e);for(var v,y,m=0,$=0;m<f;++m)if(v=g[m]){for(m>=$&&($=m+1);!(y=_[$])&&++$<f;);v._next=y||null}}return(s=new _o(s,i))._enter=a,s._exit=l,s},enter:function(){return new _o(this._enter||this._groups.map(xr),this._parents)},exit:function(){return new _o(this._exit||this._groups.map(xr),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var h,c=n[l],u=i[l],d=c.length,p=a[l]=new Array(d),f=0;f<d;++f)(h=c[f]||u[f])&&(p[f]=h);for(;l<r;++l)a[l]=n[l];return new _o(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=kr);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var s,a=n[o],l=a.length,h=r[o]=new Array(l),c=0;c<l;++c)(s=a[c])&&(h[c]=s);h.sort(e)}return new _o(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],s=0,a=o.length;s<a;++s)(r=o[s])&&t.call(r,r.__data__,s,o);return this},attr:function(t,e){var n=cr(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?Nr:Sr:"function"==typeof e?n.local?Pr:Lr:n.local?Ur:Dr)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Hr:"function"==typeof e?Rr:Or)(t,e,null==n?"":n)):function(t,e){return t.style.getPropertyValue(e)||Ir(t).getComputedStyle(t,null).getPropertyValue(e)}(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Fr:"function"==typeof e?jr:zr)(t,e)):this.node()[t]},classed:function(t,e){var n=qr(t+"");if(arguments.length<2){for(var i=Yr(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?Xr:e?Wr:Zr)(n,e))},text:function(t){return arguments.length?this.each(null==t?Jr:("function"==typeof t?Kr:Qr)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?to:("function"==typeof t?no:eo)(t)):this.node().innerHTML},raise:function(){return this.each(io)},lower:function(){return this.each(ro)},append:function(t){var e="function"==typeof t?t:pr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:pr(t),i=null==e?oo:"function"==typeof e?e:gr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(so)},clone:function(t){return this.select(t?lo:ao)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),s=o.length;if(!(arguments.length<2)){for(a=e?co:ho,i=0;i<s;++i)this.each(a(o[i],e,n));return this}var a=this.node().__on;if(a)for(var l,h=0,c=a.length;h<c;++h)for(i=0,l=a[h];i<s;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?fo:po)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};const mo=Math.PI,$o=2*mo,bo=1e-6,wo=$o-bo;function xo(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class Mo{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?xo:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return xo;const n=10**e;return function(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,i){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(t,e,n,i,r,o){this._append`C${+t},${+e},${+n},${+i},${this._x1=+r},${this._y1=+o}`}arcTo(t,e,n,i,r){if(t=+t,e=+e,n=+n,i=+i,(r=+r)<0)throw new Error(`negative radius: ${r}`);let o=this._x1,s=this._y1,a=n-t,l=i-e,h=o-t,c=s-e,u=h*h+c*c;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(u>bo)if(Math.abs(c*a-l*h)>bo&&r){let d=n-o,p=i-s,f=a*a+l*l,g=d*d+p*p,_=Math.sqrt(f),v=Math.sqrt(u),y=r*Math.tan((mo-Math.acos((f+u-g)/(2*_*v)))/2),m=y/v,$=y/_;Math.abs(m-1)>bo&&this._append`L${t+m*h},${e+m*c}`,this._append`A${r},${r},0,0,${+(c*d>h*p)},${this._x1=t+$*a},${this._y1=e+$*l}`}else this._append`L${this._x1=t},${this._y1=e}`;else;}arc(t,e,n,i,r,o){if(t=+t,e=+e,o=!!o,(n=+n)<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(i),a=n*Math.sin(i),l=t+s,h=e+a,c=1^o,u=o?i-r:r-i;null===this._x1?this._append`M${l},${h}`:(Math.abs(this._x1-l)>bo||Math.abs(this._y1-h)>bo)&&this._append`L${l},${h}`,n&&(u<0&&(u=u%$o+$o),u>wo?this._append`A${n},${n},0,1,${c},${t-s},${e-a}A${n},${n},0,1,${c},${this._x1=l},${this._y1=h}`:u>bo&&this._append`A${n},${n},0,${+(u>=mo)},${c},${this._x1=t+n*Math.cos(r)},${this._y1=e+n*Math.sin(r)}`)}rect(t,e,n,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}}function Co(t){this._context=t}function Ao(t){return new Co(t)}function To(t){return t[0]}function Eo(t){return t[1]}function ko(t,e){var n=yo(!0),i=null,r=Ao,o=null,s=function(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);e=t}return t},()=>new Mo(e)}(a);function a(a){var l,h,c,u=(a=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}(a)).length,d=!1;for(null==i&&(o=r(c=s())),l=0;l<=u;++l)!(l<u&&n(h=a[l],l,a))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+t(h,l,a),+e(h,l,a));if(c)return o=null,c+""||null}return t="function"==typeof t?t:void 0===t?To:yo(t),e="function"==typeof e?e:void 0===e?Eo:yo(e),a.x=function(e){return arguments.length?(t="function"==typeof e?e:yo(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:yo(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:yo(!!t),a):n},a.curve=function(t){return arguments.length?(r=t,null!=i&&(o=r(i)),a):r},a.context=function(t){return arguments.length?(null==t?i=o=null:o=r(i=t),a):i},a}function So(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function No(t){this._context=t}function Do(t){return new No(t)}function Uo(t,e){this._context=t,this._t=e}function Lo(t){return new Uo(t,.5)}Co.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}},No.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:So(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:So(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Uo.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};const Po=a`.card-content{padding:16px}.card-content.short .graph-container{right:70px}.entity-row{align-items:center;cursor:pointer;display:flex;height:40px;margin-bottom:8px;position:relative}.entity-row:last-of-type{margin-bottom:0}.entity-icon{color:var(--primary-text-color);fill:currentColor;margin-right:8px;text-align:center;width:40px}.entity-name{z-index:1}.entity-value{color:var(--primary-text-color);margin-left:auto;z-index:1}.graph-container{bottom:0;left:45px;pointer-events:none;position:absolute;right:0;top:0}.graph-container svg{height:100%;width:100%}.graph-path{fill:none;stroke-linecap:round;stroke-linejoin:round}.graph-dot{opacity:0;transition:opacity .2s ease-in-out}.entity-row:hover .graph-dot{opacity:1}`,Io="background-graph-entities",Ho=`${Io}-editor`,Oo=1e3,Ro=36e5;console.info("%c BACKGROUND-GRAPH-ENTITIES %c 1.0.1 ","color: orange; font-weight: bold; background: black","color: white; font-weight: bold; background: dimgray");let Fo=class extends at{constructor(){super(...arguments),this.editMode=!1,this._entities=[],this._history=new Map,this._historyFetched=!1,this._renderRetryMap=new Map}setConfig(t){if(!t||!t.entities||!Array.isArray(t.entities)||0===t.entities.length)throw new Error("You need to define at least one entity");this._config=t,this._entities=t.entities.map(t=>"string"==typeof t?{entity:t}:t),this._historyFetched=!1,this._history=new Map,this._setupUpdateInterval()}connectedCallback(){super.connectedCallback(),this._setupUpdateInterval()}disconnectedCallback(){super.disconnectedCallback(),this._timerId&&(clearInterval(this._timerId),this._timerId=void 0)}_setupUpdateInterval(){if(this._timerId&&clearInterval(this._timerId),!this._config)return;const t=this._config.update_interval;t&&(this._timerId=window.setInterval(()=>this._fetchAndStoreAllHistory(),t*Oo))}static async getConfigElement(){const t=window.loadCardHelpers;if(!t)throw new Error("This card requires Home Assistant 2023.4+ and `loadCardHelpers` is not available.");const e=await t(),n=await e.createCardElement({type:"entities",entities:[]});return await n.constructor.getConfigElement(),await Promise.resolve().then(function(){return vs}),document.createElement(Ho)}static getStubConfig(){return{entities:[{entity:"sun.sun"}],hours_to_show:24}}updated(t){this._config&&this.hass&&!this._historyFetched&&(this._historyFetched=!0,this._fetchAndStoreAllHistory()),(t.has("_history")||t.has("editMode"))&&requestAnimationFrame(()=>this._renderAllGraphs())}_getCurveFactory(){const t={linear:Ao,step:Lo,spline:Do};return t[this._config?.curve||"spline"]??t.spline}_renderAllGraphs(){if(!this.isConnected)return;const t=this.renderRoot.querySelectorAll(".graph-container");this._config?.entities&&t.forEach(t=>{const e=t.dataset.entityId;if(e){const n=this._entities.find(t=>t.entity===e),i=this._history.get(e);this._renderD3Graph(t,i,n)}})}_createGradient(t,e,n,i){const r=mt(i,t=>t.value),o=t.append("defs").append("linearGradient").attr("id",n).attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",e(r[0])).attr("x2",0).attr("y2",e(r[1])),s=[...i].sort((t,e)=>t.value-e.value);return s.forEach(t=>{const e=r[1]-r[0],n=e>0?(t.value-r[0])/e:0;o.append("stop").attr("offset",100*Math.max(0,Math.min(1,n))+"%").attr("stop-color",t.color)}),`url(#${n})`}_setupGradient(t,e,n,i){const r=this.hass.themes?.darkMode??!1?"white":"black";if(i?.overwrite_graph_appearance){const o=i.color_thresholds;return o&&o.length>0?this._createGradient(t,e,n,o):i.line_color??this._config.line_color??r}const o=this._config.color_thresholds;return o&&o.length>0?this._createGradient(t,e,n,o):this._config.line_color??r}_getDotColor(t,e){const n=this.hass.themes?.darkMode??!1?"white":"black";let i,r;if(e?.overwrite_graph_appearance&&(i=e.color_thresholds,r=e.line_color),void 0===i&&(i=this._config.color_thresholds),void 0===r&&(r=this._config.line_color),i&&i.length>0){const e=[...i].sort((t,e)=>t.value-e.value);let n=e[0].color;for(const i of e){if(!(t>=i.value))break;n=i.color}return n}return r??n}getCardSize(){return this._config?.entities.length?this._config.entities.length+1:1}_openEntityPopup(t){const e=new CustomEvent("hass-more-info",{bubbles:!0,cancelable:!1,composed:!0,detail:{entityId:t}});this.dispatchEvent(e)}_renderEntityRow(t){const e=this.hass.states[t.entity];if(!e)return this._renderUnavailableEntityRow(t);const n=e.attributes.unit_of_measurement??"";let i=e.state;const r=parseFloat(e.state);if("min"===n.toLowerCase()&&r>60){i=`${Math.floor(r/60)}h ${r%60}min`}else i=[e.state,n].filter(Boolean).join(" ");return q`
      <div class="entity-row" @click=${()=>this._openEntityPopup(t.entity)}>
        ${t.icon?q`<ha-icon class="entity-icon" .icon=${t.icon}></ha-icon>`:q`<ha-state-icon class="entity-icon" .hass=${this.hass} .stateObj=${e}></ha-state-icon>`}
        <div class="entity-name">${t.name||e.attributes.friendly_name||t.entity}</div>
        <div class="graph-container" data-entity-id=${t.entity}></div>
        <div class="entity-value">${i}</div>
      </div>
    `}_renderUnavailableEntityRow(t){return q`
      <div class="entity-row unavailable" @click=${()=>this._openEntityPopup(t.entity)}>
        <ha-icon class="entity-icon" icon=${"mdi:alert-circle-outline"}></ha-icon>
        <div class="entity-name">${t.name||t.entity}</div>
        <div class="graph-container" data-entity-id=${t.entity}></div>
        <div class="entity-value">${this.hass.localize("state.default.unavailable")||"Unavailable"}</div>
      </div>
    `}_renderD3Graph(t,e,n){const i=this._renderRetryMap.get(t)||0;if(!t.isConnected||0===t.clientWidth||0===t.clientHeight)return void(i<10&&(this._renderRetryMap.set(t,i+1),requestAnimationFrame(()=>this._renderD3Graph(t,e,n))));if(this._renderRetryMap.delete(t),vo(t).html(""),!e||0===e.length)return;const r=t.clientWidth,o=t.clientHeight,s=this._config?.hours_to_show||24,a=new Date,l=new Date;l.setHours(a.getHours()-s);const h=[l,a],c=[...e],u=c[c.length-1];if(u&&c.push({timestamp:a,value:u.value}),c.length<2)return;const d=mt(c,t=>t.value);d[0]===d[1]&&(d[0]-=1,d[1]+=1);const p=.1*(d[1]-d[0]);d[0]-=p,d[1]+=p;const f=ar().domain(h).range([0,r]),g=Ge().domain(d).range([o,0]),_=vo(t).append("svg").attr("viewBox",`0 0 ${r} ${o}`).attr("preserveAspectRatio","none"),v=`bge-glow-${t.dataset.entityId}`;if(this._config.line_glow){const t=_.append("defs").append("filter").attr("id",v).attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");t.append("feGaussianBlur").attr("stdDeviation",2.5).attr("result","coloredBlur");const e=t.append("feMerge");e.append("feMergeNode").attr("in","coloredBlur"),e.append("feMergeNode").attr("in","SourceGraphic")}const y=`bge-gradient-${t.dataset.entityId}`,m=this._setupGradient(_,g,y,n),$=ko().x(t=>f(t.timestamp)).y(t=>g(t.value)).curve(this._getCurveFactory());_.append("path").datum(c).attr("class","graph-path").attr("d",$).attr("stroke",m).attr("stroke-opacity",n?.overwrite_graph_appearance&&void 0!==n.line_opacity?n.line_opacity:this._config?.line_opacity??.2).attr("stroke-width",this._config?.line_width||3).attr("filter",this._config.line_glow?`url(#${v})`:null);const b=e.slice(1);this.editMode&&_.selectAll(".graph-dot").data(b).enter().append("circle").attr("class","graph-dot").attr("cx",t=>f(t.timestamp)).attr("cy",t=>g(t.value)).attr("r",2).attr("fill",t=>this._getDotColor(t.value,n))}async _fetchAndStoreAllHistory(){if(0===this._entities.length)return void(this._history.size>0&&(this._history=new Map));const t=new Map,e=this._entities.filter(t=>t.entity).map(async e=>{const n=e.entity,i=await this._fetchHistory(n);i&&t.set(n,i)});await Promise.all(e),this._history=t}_downsampleHistory(t,e,n){if(n<=0||0===t.length)return t;const i=new Date,r=new Date(i.getTime()-e*Ro),o=Ro/n,s=Math.ceil((i.getTime()-r.getTime())/o),a=Array.from({length:s},()=>({values:[]}));for(const e of t){const t=e.timestamp.getTime();if(t<r.getTime())continue;const n=Math.floor((t-r.getTime())/o);n>=0&&n<s&&a[n].values.push(e.value)}const l=[];let h=t[0].value;for(let t=0;t<s;t++){const e=a[t];let n;if(e.values.length>0){const t=e.values.sort((t,e)=>t-e),i=Math.floor(t.length/2);n=t.length%2!=0?t[i]:(t[i-1]+t[i])/2,h=n}else n=h;l.push({timestamp:new Date(r.getTime()+(t+1)*o),value:n})}return l.length>0&&l.unshift({timestamp:r,value:t[0].value}),l}async _fetchHistory(t){if(!this.hass?.callWS)return null;const e=this._config?.hours_to_show||24,n=this._config?.points_per_hour||1,i=new Date;i.setHours(i.getHours()-e);try{const r=(await this.hass.callWS({type:"history/history_during_period",start_time:i.toISOString(),end_time:(new Date).toISOString(),entity_ids:[t],minimal_response:!0,no_attributes:!0,include_start_time_state:!0}))[t];if(!r)return[];const o=r.map(t=>{let e;return e="on"===t.s?1:"off"===t.s?0:Number(t.s),{timestamp:new Date(t.lu*Oo),value:e}}).filter(t=>!isNaN(t.value));return this._downsampleHistory(o,e,n)}catch(e){return console.error(`Error fetching history for ${t}:`,e),null}}render(){return this._config&&this.hass?q`
      <ha-card .header=${this._config.title}>
        <div class="card-content ${"short"===this._config.line_length?"short":""}">
          ${this._entities.map(t=>this._renderEntityRow(t))}
        </div>
      </ha-card>
    `:q``}static{this.styles=a`
    ${s(Po)}
  `}};t([dt({attribute:!1})],Fo.prototype,"hass",void 0),t([dt({type:Boolean,reflect:!0})],Fo.prototype,"editMode",void 0),t([pt()],Fo.prototype,"_config",void 0),t([pt()],Fo.prototype,"_entities",void 0),t([pt()],Fo.prototype,"_history",void 0),Fo=t([ht(Io)],Fo),"undefined"!=typeof window&&(window.customCards=window.customCards||[],window.customCards.push({type:Io,name:"Background Graph Entities",description:"A card to display entities with a background graph."}));const zo={de:{editor:{general:"Allgemein",title:"Titel (Optional)",graph_appearance:"Graph-Darstellung",hours_to_show:"Stunden zum Anzeigen",line_width:"Linienbreite",line_length:"Linienlänge",line_length_long:"Lang",line_length_short:"Kurz",line_color:"Linienfarbe",line_opacity:"Linienopazität",color_mode:"Farbmodus",color_mode_single:"Einzelfarbe",color_mode_threshold:"Schwellenwerte",color_thresholds:"Farbschwellenwerte",add_threshold:"Schwellenwert hinzufügen",value:"Wert",color:"Farbe",data_settings:"Dateneinstellungen",points_per_hour:"Punkte pro Stunde",update_interval:"Aktualisierungsintervall (Sekunden)",entities:"Entitäten",entity:"Entität",add_entity:"Entität hinzufügen",optional_overrides:"Optionale Überschreibungen",name:"Name",icon:"Icon",line_glow:"Leuchteffekt",curve:"Kurventyp",curve_spline:"Spline",curve_linear:"Linear",curve_step:"Stufe"}},en:{editor:{general:"General",title:"Title (Optional)",graph_appearance:"Graph Appearance",hours_to_show:"Hours To Show",line_width:"Line Width",line_length:"Line Length",line_length_long:"Long",line_length_short:"Short",line_color:"Line Color",line_opacity:"Line Opacity",line_glow:"Line Glow",color_mode:"Color Mode",color_mode_single:"Single Color",color_mode_threshold:"Thresholds",color_thresholds:"Color Thresholds",add_threshold:"Add Threshold",value:"Value",color:"Color",data_settings:"Data Settings",points_per_hour:"Points per Hour",update_interval:"Update Interval (seconds)",entities:"Entities",entity:"Entity",add_entity:"Add Entity",optional_overrides:"Optional Overrides",name:"Name",icon:"Icon",curve:"Curve Type",curve_spline:"Spline",curve_linear:"Linear",curve_step:"Step"}}};function jo(t,e){let n=zo[t];for(const t of e){if("object"!=typeof n||null===n)return;n=n[t]}return"string"==typeof n?n:void 0}function qo(t,e,n={}){const i=t.language||"en",r=e.replace("component.bge.","").split("."),o=jo(i,r)??jo("en",r);if("string"==typeof o){let t=o;for(const e in n)t=t.replace(`{${e}}`,String(n[e]));return t}return e}const Yo=(t,e,n,i)=>{const r=new CustomEvent(e,{bubbles:!0,cancelable:!1,composed:!0,...i,detail:n});t.dispatchEvent(r)},Bo=a`.color-input-wrapper{position:relative;flex:1}.color-picker-popup{position:absolute;top:100%;left:0;z-index:10;padding:8px;background-color:var(--card-background-color, white);border:1px solid var(--divider-color);border-radius:var(--ha-card-border-radius, 4px);box-shadow:0px 5px 5px -3px rgba(0,0,0,.2),0px 8px 10px 1px rgba(0,0,0,.14),0px 3px 14px 2px rgba(0,0,0,.12)}.color-picker-popup rgb-string-color-picker{width:200px;height:200px}.color-preview{width:28px;height:28px;border-radius:4px;border:1px solid var(--divider-color);cursor:pointer;box-sizing:border-box}.card-config{display:flex;flex-direction:column;gap:16px}.color-picker-popup{display:none}.side-by-side{display:flex;gap:16px}.side-by-side>*{flex:1}.entities-container{display:flex;flex-direction:column;gap:12px}.entity-container{align-items:center;border:1px solid var(--divider-color);border-radius:var(--ha-card-border-radius, 4px);display:flex;gap:8px;padding:8px;transition:border-color .2s ease-in-out,box-shadow .2s ease-in-out,background-color .2s ease-in-out}.entity-container.dragging{background:var(--secondary-background-color);opacity:.5}.entity-container.drag-over{border-color:var(--primary-color);border-style:dashed;box-shadow:0 0 5px var(--primary-color)}.drag-handle{color:var(--secondary-text-color);cursor:move}.entity-content{flex-grow:1}.entity-main{align-items:center;display:flex;gap:8px}.entity-main ha-entity-picker{flex-grow:1}ha-slider{width:100%}ha-expansion-panel{--expansion-panel-content-padding: 0;margin-top:8px}ha-expansion-panel[outlined][expanded]{--ha-card-background: var(--secondary-background-color)}.overrides{display:flex;flex-direction:column;gap:16px;padding:16px}pre{background:var(--secondary-background-color);border-radius:var(--ha-card-border-radius, 4px);font-size:12px;padding:8px;white-space:pre-wrap;word-break:break-all}.threshold-container{align-items:center;display:flex;gap:8px}.threshold-container .threshold-inputs{align-items:flex-end;display:flex;flex-grow:1;gap:16px}.color-input-wrapper{align-items:center;display:flex;gap:8px}.color-input-wrapper ha-textfield{flex-grow:1}.color-preview{border:1px solid var(--divider-color);border-radius:4px;box-sizing:border-box;cursor:pointer;flex-shrink:0;height:28px;width:28px}.opacity-slider-container{display:flex;flex-direction:column;width:100%}.label-container{color:var(--secondary-text-color);display:flex;font-size:12px;justify-content:space-between;margin-bottom:-8px;margin-left:3px}.header{align-items:center;display:flex;gap:8px;margin-bottom:16px}.header .title{font-size:1.2em;font-weight:500}`,Vo=(t,e=0,n=1)=>t>n?n:t<e?e:t,Go=(t,e=0,n=Math.pow(10,e))=>Math.round(n*t)/n,Wo=t=>{const{h:e,s:n,l:i}=(({h:t,s:e,v:n,a:i})=>{const r=(200-e)*n/100;return{h:Go(t),s:Go(r>0&&r<200?e*n/100/(r<=100?r:200-r)*100:0),l:Go(r/2),a:Go(i,2)}})(t);return`hsl(${e}, ${n}%, ${i}%)`},Zo=t=>{const e=/rgba?\(?\s*(-?\d*\.?\d+)(%)?[,\s]+(-?\d*\.?\d+)(%)?[,\s]+(-?\d*\.?\d+)(%)?,?\s*[/\s]*(-?\d*\.?\d+)?(%)?\s*\)?/i.exec(t);return e?Xo({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):{h:0,s:0,v:0,a:1}},Xo=({r:t,g:e,b:n,a:i})=>{const r=Math.max(t,e,n),o=r-Math.min(t,e,n),s=o?r===t?(e-n)/o:r===e?2+(n-t)/o:4+(t-e)/o:0;return{h:Go(60*(s<0?s+6:s)),s:Go(r?o/r*100:0),v:Go(r/255*100),a:i}},Jo={},Qo=t=>{let e=Jo[t];return e||(e=document.createElement("template"),e.innerHTML=t,Jo[t]=e),e},Ko=(t,e,n)=>{t.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:n}))};let ts=!1;const es=t=>"touches"in t,ns=(t,e)=>{const n=es(e)?e.touches[0]:e,i=t.el.getBoundingClientRect();Ko(t.el,"move",t.getMove({x:Vo((n.pageX-(i.left+window.pageXOffset))/i.width),y:Vo((n.pageY-(i.top+window.pageYOffset))/i.height)}))};class is{constructor(t,e,n,i){const r=Qo(`<div role="slider" tabindex="0" part="${e}" ${n}><div part="${e}-pointer"></div></div>`);t.appendChild(r.content.cloneNode(!0));const o=t.querySelector(`[part=${e}]`);o.addEventListener("mousedown",this),o.addEventListener("touchstart",this),o.addEventListener("keydown",this),this.el=o,this.xy=i,this.nodes=[o.firstChild,o]}set dragging(t){const e=t?document.addEventListener:document.removeEventListener;e(ts?"touchmove":"mousemove",this),e(ts?"touchend":"mouseup",this)}handleEvent(t){switch(t.type){case"mousedown":case"touchstart":if(t.preventDefault(),!(t=>!(ts&&!es(t)||(ts||(ts=es(t)),0)))(t)||!ts&&0!=t.button)return;this.el.focus(),ns(this,t),this.dragging=!0;break;case"mousemove":case"touchmove":t.preventDefault(),ns(this,t);break;case"mouseup":case"touchend":this.dragging=!1;break;case"keydown":((t,e)=>{const n=e.keyCode;n>40||t.xy&&n<37||n<33||(e.preventDefault(),Ko(t.el,"move",t.getMove({x:39===n?.01:37===n?-.01:34===n?.05:33===n?-.05:35===n?1:36===n?-1:0,y:40===n?.01:38===n?-.01:0},!0)))})(this,t)}}style(t){t.forEach((t,e)=>{for(const n in t)this.nodes[e].style.setProperty(n,t[n])})}}class rs extends is{constructor(t){super(t,"hue",'aria-label="Hue" aria-valuemin="0" aria-valuemax="360"',!1)}update({h:t}){this.h=t,this.style([{left:t/360*100+"%",color:Wo({h:t,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuenow",`${Go(t)}`)}getMove(t,e){return{h:e?Vo(this.h+360*t.x,0,360):360*t.x}}}class os extends is{constructor(t){super(t,"saturation",'aria-label="Color"',!0)}update(t){this.hsva=t,this.style([{top:100-t.v+"%",left:`${t.s}%`,color:Wo(t)},{"background-color":Wo({h:t.h,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuetext",`Saturation ${Go(t.s)}%, Brightness ${Go(t.v)}%`)}getMove(t,e){return{s:e?Vo(this.hsva.s+100*t.x,0,100):100*t.x,v:e?Vo(this.hsva.v-100*t.y,0,100):Math.round(100-100*t.y)}}}const ss=Symbol("same"),as=Symbol("color"),ls=Symbol("hsva"),hs=Symbol("update"),cs=Symbol("parts"),us=Symbol("css"),ds=Symbol("sliders");class ps extends HTMLElement{static get observedAttributes(){return["color"]}get[us](){return[':host{display:flex;flex-direction:column;position:relative;width:200px;height:200px;user-select:none;-webkit-user-select:none;cursor:default}:host([hidden]){display:none!important}[role=slider]{position:relative;touch-action:none;user-select:none;-webkit-user-select:none;outline:0}[role=slider]:last-child{border-radius:0 0 8px 8px}[part$=pointer]{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;display:flex;place-content:center center;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}[part$=pointer]::after{content:"";width:100%;height:100%;border-radius:inherit;background-color:currentColor}[role=slider]:focus [part$=pointer]{transform:translate(-50%,-50%) scale(1.1)}',"[part=hue]{flex:0 0 24px;background:linear-gradient(to right,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%)}[part=hue-pointer]{top:50%;z-index:2}","[part=saturation]{flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(to top,#000,transparent),linear-gradient(to right,#fff,rgba(255,255,255,0));box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}[part=saturation-pointer]{z-index:3}"]}get[ds](){return[os,rs]}get color(){return this[as]}set color(t){if(!this[ss](t)){const e=this.colorModel.toHsva(t);this[hs](e),this[as]=t}}constructor(){super();const t=Qo(`<style>${this[us].join("")}</style>`),e=this.attachShadow({mode:"open"});e.appendChild(t.content.cloneNode(!0)),e.addEventListener("move",this),this[cs]=this[ds].map(t=>new t(e))}connectedCallback(){if(this.hasOwnProperty("color")){const t=this.color;delete this.color,this.color=t}else this.color||(this.color=this.colorModel.defaultColor)}attributeChangedCallback(t,e,n){const i=this.colorModel.fromAttr(n);this[ss](i)||(this.color=i)}handleEvent(t){const e=this[ls],n={...e,...t.detail};let i;this[hs](n),((t,e)=>{if(t===e)return!0;for(const n in t)if(t[n]!==e[n])return!1;return!0})(n,e)||this[ss](i=this.colorModel.fromHsva(n))||(this[as]=i,Ko(this,"color-changed",{value:i}))}[ss](t){return this.color&&this.colorModel.equal(t,this.color)}[hs](t){this[ls]=t,this[cs].forEach(e=>e.update(t))}}const fs={defaultColor:"rgb(0, 0, 0)",toHsva:Zo,fromHsva:t=>{const{r:e,g:n,b:i}=(({h:t,s:e,v:n,a:i})=>{t=t/360*6,e/=100,n/=100;const r=Math.floor(t),o=n*(1-e),s=n*(1-(t-r)*e),a=n*(1-(1-t+r)*e),l=r%6;return{r:Go(255*[n,s,o,o,a,n][l]),g:Go(255*[a,n,n,s,o,o][l]),b:Go(255*[o,o,a,n,n,s][l]),a:Go(i,2)}})(t);return`rgb(${e}, ${n}, ${i})`},equal:(t,e)=>t.replace(/\s/g,"")===e.replace(/\s/g,""),fromAttr:t=>t};class gs extends ps{get colorModel(){return fs}}customElements.define("rgb-string-color-picker",class extends gs{});let _s=class extends at{constructor(){super(...arguments),this._config={type:"custom:background-graph-entities",entities:[],color_thresholds:[]},this._draggedIndex=null,this._dropIndex=null,this._draggedThresholdIndex=null,this._dropThresholdIndex=null,this._activeColorPicker=null,this._editingIndex=null,this._handleOutsideClick=t=>{if(!this._activeColorPicker)return;if(t.composedPath().some(t=>t instanceof HTMLElement&&(t.classList.contains("color-input-wrapper")||t.classList.contains("color-picker-popup"))))return;this.renderRoot.querySelectorAll(".color-picker-popup").forEach(t=>t.style.display="none"),this._activeColorPicker=null}}setConfig(t){const e=(t.entities||[]).filter(Boolean).map(t=>"string"==typeof t?{entity:t}:t);this._config={...t,entities:e,color_thresholds:t.color_thresholds||[]},this.requestUpdate()}connectedCallback(){super.connectedCallback(),document.addEventListener("mousedown",this._handleOutsideClick)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("mousedown",this._handleOutsideClick)}_toggleColorPicker(t,e){t.stopPropagation();const n=this.renderRoot.querySelector(`.color-picker-popup[data-picker-id="${e}"]`);if(!n)return;const i="none"!==n.style.display;this.renderRoot.querySelectorAll(".color-picker-popup").forEach(t=>t.style.display="none"),i?this._activeColorPicker=null:(n.style.display="block",this._activeColorPicker=e)}_handleColorModeChange(t){const e=t.target.value;if(e===((this._config.color_thresholds?.length??0)>0?"threshold":"single")||!this._config)return;const n={...this._config};"threshold"===e?n.color_thresholds&&0!==n.color_thresholds.length||(n.color_thresholds=[{value:0,color:"#000000"}]):n.color_thresholds=[],this._config=n,Yo(this,"config-changed",{config:n})}_valueChanged(t){const e=t.target,n=e.configValue;if(!n||!this._config)return;const i={...this._config};let r;r="ha-switch"===e.tagName?.toLowerCase()?e.checked:e.value,"number"===e.type&&(r=""===e.value?void 0:Number(e.value)),!1===r||void 0===r||"number"==typeof r&&isNaN(r)?delete i[n]:i[n]=r,this._config=i,Yo(this,"config-changed",{config:i})}_entityAttributeChanged(t){const e=t.target,n=Number(e.dataset.index),i=e.dataset.field;if(!this._config||isNaN(n)||!i)return;let r=t.detail?.value??e.value;"ha-slider"!==e.tagName.toLowerCase()&&"number"!==e.type||(r=""===e.value?void 0:Number(e.value));const o=[...this._config.entities],s={...o[n]};""===r||void 0===r||"number"==typeof r&&isNaN(r)?delete s[i]:s[i]=r,o[n]=s;const a={...this._config,entities:o};this._config=a,Yo(this,"config-changed",{config:a})}_colorPicked(t){const e=t.target.configValue;if(!e||!this._config)return;const n=t.detail.value;if(this._config[e]===n)return;const i={...this._config,[e]:n||void 0};this._config=i,Yo(this,"config-changed",{config:i})}_thresholdChanged(t,e){if(!this._config)return;const n=t.target,i=n.dataset.field,r=n.tagName.toLowerCase().includes("color-picker")?t.detail.value:n.value,o=[...this._config.color_thresholds];o[e]={...o[e],[i]:"value"===i?Number(r):r};const s={...this._config,color_thresholds:o};this._config=s,Yo(this,"config-changed",{config:s})}_addThreshold(){if(!this._config)return;const t=[...this._config.color_thresholds,{value:0,color:"#000000"}],e={...this._config,color_thresholds:t};this._config=e,Yo(this,"config-changed",{config:e})}_removeThreshold(t){if(!this._config)return;const e=[...this._config.color_thresholds];e.splice(t,1);const n={...this._config,color_thresholds:e};this._config=n,Yo(this,"config-changed",{config:n})}_handleEntityColorModeChange(t,e){const n=t.target.value,i=this._config.entities[e];if(n===((i.color_thresholds?.length??0)>0?"threshold":"single"))return;const r=[...this._config.entities],o={...r[e]};"threshold"===n?(delete o.line_color,o.color_thresholds&&0!==o.color_thresholds.length||(o.color_thresholds=[{value:0,color:"#000000"}])):delete o.color_thresholds,r[e]=o;const s={...this._config,entities:r};this._config=s,Yo(this,"config-changed",{config:s})}_entityThresholdChanged(t,e,n){if(!this._config)return;const i=t.target,r=i.dataset.field,o=i.tagName.toLowerCase().includes("color-picker")?t.detail.value:i.value,s=[...this._config.entities],a={...s[e]},l=[...a.color_thresholds||[]];l[n]={...l[n],[r]:"value"===r?Number(o):o},a.color_thresholds=l,s[e]=a;const h={...this._config,entities:s};this._config=h,Yo(this,"config-changed",{config:h})}_addEntityThreshold(t){if(!this._config)return;const e=[...this._config.entities],n={...e[t]},i=[...n.color_thresholds||[],{value:0,color:"#000000"}];n.color_thresholds=i,e[t]=n;const r={...this._config,entities:e};this._config=r,Yo(this,"config-changed",{config:r})}_removeEntityThreshold(t,e){if(!this._config)return;const n=[...this._config.entities],i={...n[t]},r=[...i.color_thresholds||[]];r.splice(e,1),0===r.length?delete i.color_thresholds:i.color_thresholds=r,n[t]=i;const o={...this._config,entities:n};this._config=o,Yo(this,"config-changed",{config:o})}_handleThresholdDragStart(t,e){this._draggedThresholdIndex=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}_handleThresholdDragOver(t,e){t.preventDefault(),e!==this._draggedThresholdIndex&&(this._dropThresholdIndex=e)}_handleThresholdDrop(t){if(t.preventDefault(),null===this._draggedThresholdIndex||null===this._dropThresholdIndex)return;const e=[...this._config.color_thresholds],[n]=e.splice(this._draggedThresholdIndex,1);e.splice(this._dropThresholdIndex,0,n);const i={...this._config,color_thresholds:e};this._config=i,Yo(this,"config-changed",{config:i}),this._draggedThresholdIndex=null,this._dropThresholdIndex=null}_handleEntityThresholdDragStart(t,e){this._draggedThresholdIndex=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}_handleEntityThresholdDragOver(t,e){t.preventDefault(),e!==this._draggedThresholdIndex&&(this._dropThresholdIndex=e)}_handleEntityThresholdDrop(t,e){if(t.preventDefault(),null===this._draggedThresholdIndex||null===this._dropThresholdIndex)return;const n=[...this._config.entities],i={...n[e]},r=[...i.color_thresholds||[]],[o]=r.splice(this._draggedThresholdIndex,1);r.splice(this._dropThresholdIndex,0,o),i.color_thresholds=r,n[e]=i;const s={...this._config,entities:n};this._config=s,Yo(this,"config-changed",{config:s}),this._draggedThresholdIndex=null,this._dropThresholdIndex=null}_handleDragStart(t,e){this._draggedIndex=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",String(e)))}_handleDragOver(t,e){t.preventDefault(),e!==this._draggedIndex&&(this._dropIndex=e)}_handleDragLeave(){this._dropIndex=null}_handleDrop(t){if(t.preventDefault(),null===this._draggedIndex||null===this._dropIndex||this._draggedIndex===this._dropIndex)return void this._handleDragEnd();const e=[...this._config.entities],[n]=e.splice(this._draggedIndex,1);e.splice(this._dropIndex,0,n);const i={...this._config,entities:e};this._config=i,Yo(this,"config-changed",{config:i}),this._handleDragEnd()}_handleDragEnd(){this._draggedIndex=null,this._dropIndex=null}_addEntity(){const t=[...this._config.entities,{entity:""}],e={...this._config,entities:t};this._config=e,Yo(this,"config-changed",{config:e})}_removeEntity(t){const e=[...this._config.entities];e.splice(t,1);const n={...this._config,entities:e};this._config=n,Yo(this,"config-changed",{config:n})}_overwriteAppearanceChanged(t){const e=t.target,n=Number(e.dataset.index),i=e.checked;if(!this._config||isNaN(n))return;const r=[...this._config.entities],o={...r[n]};i?o.overwrite_graph_appearance=!0:(delete o.overwrite_graph_appearance,delete o.line_color,delete o.line_opacity,delete o.color_thresholds),r[n]=o;const s={...this._config,entities:r};this._config=s,Yo(this,"config-changed",{config:s}),this.requestUpdate()}_editEntity(t){this._editingIndex=t,this.requestUpdate()}_goBack(){this._editingIndex=null,this.requestUpdate()}_renderEntityEditor(){if(null===this._editingIndex)return q``;const t=this._config.entities[this._editingIndex];if(!t)return q``;const e=t.overwrite_graph_appearance??!1;return q`
      <div class="header">
        <ha-icon-button
          .path=${"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"}
          @click=${this._goBack}
        ></ha-icon-button>
        <span class="title">${t.name||t.entity}</span>
      </div>
      <div class="card-config">
        <ha-textfield
          .label=${qo(this.hass,"component.bge.editor.name")}
          .value=${t.name||""}
          .configValue=${"name"}
          data-index=${this._editingIndex}
          data-field="name"
          @change=${this._entityAttributeChanged}
        ></ha-textfield>
        <ha-icon-picker
          .hass=${this.hass}
          .label=${qo(this.hass,"component.bge.editor.icon")}
          .value=${t.icon||""}
          data-index=${this._editingIndex}
          data-field="icon"
          @value-changed=${this._entityAttributeChanged}
        ></ha-icon-picker>

        <ha-formfield .label=${qo(this.hass,"component.bge.editor.optional_overrides")}>
          <ha-switch
            .checked=${e}
            data-index=${this._editingIndex}
            @change=${this._overwriteAppearanceChanged}
          ></ha-switch>
        </ha-formfield>

        ${e?this._renderEntityGraphAppearanceEditor(this._editingIndex):""}
      </div>
    `}_renderEntityGraphAppearanceEditor(t){const e=this._config.entities[t];if(!e)return q``;const n=(e.color_thresholds?.length??0)>0?"threshold":"single",i=this.hass.themes?.darkMode??!1?"white":"black",r=e.line_color||this._config.line_color||i;return q`
      <div class="overrides">
        <h3>${qo(this.hass,"component.bge.editor.graph_appearance")}</h3>

        <div class="opacity-slider-container">
          <div class="label-container">
            <span>${qo(this.hass,"component.bge.editor.line_opacity")}</span>
            <span>${Number(e.line_opacity??this._config.line_opacity??.2).toFixed(3)}</span>
          </div>
          <ha-slider
            min="0.05"
            max="0.8"
            step="0.025"
            .value=${e.line_opacity??this._config.line_opacity??.2}
            data-index=${t}
            data-field="line_opacity"
            @change=${this._entityAttributeChanged}
            pin
          ></ha-slider>
        </div>

        <ha-select
          .label=${qo(this.hass,"component.bge.editor.color_mode")}
          .value=${n}
          @selected=${e=>this._handleEntityColorModeChange(e,t)}
          @closed=${t=>t.stopPropagation()}
        >
          <mwc-list-item value="single">${qo(this.hass,"component.bge.editor.color_mode_single")}</mwc-list-item>
          <mwc-list-item value="threshold"
            >${qo(this.hass,"component.bge.editor.color_mode_threshold")}</mwc-list-item
          >
        </ha-select>

        ${"single"===n?q`
              <div
                class="color-input-wrapper"
                data-picker-id="entity_line_color_${t}"
                @mousedown=${e=>this._toggleColorPicker(e,`entity_line_color_${t}`)}
              >
                <ha-textfield
                  .label=${qo(this.hass,"component.bge.editor.line_color")}
                  .value=${e.line_color??""}
                  .placeholder=${this._config.line_color||i}
                  data-index=${t}
                  data-field="line_color"
                  @change=${this._entityAttributeChanged}
                ></ha-textfield>
                <div class="color-preview" style="background-color: ${r}"></div>
                <div
                  class="color-picker-popup"
                  data-picker-id="entity_line_color_${t}"
                  @mousedown=${t=>t.stopPropagation()}
                >
                  <rgb-string-color-picker
                    .color=${r}
                    data-index=${t}
                    data-field="line_color"
                    @color-changed=${this._entityAttributeChanged}
                    alpha
                  ></rgb-string-color-picker>
                </div>
              </div>
            `:this._renderEntityThresholdsEditor(t)}
      </div>
    `}_renderEntityThresholdsEditor(t){const e=this._config.entities[t];return e?q`
      <div>
        <h4>${qo(this.hass,"component.bge.editor.color_thresholds")}</h4>
        <div class="entities-container">
          ${(e.color_thresholds||[]).map((e,n)=>q`
              <div
                class="entity-container threshold-container ${this._dropThresholdIndex===n?"drag-over":""} ${this._draggedThresholdIndex===n?"dragging":""}"
                draggable="true"
                @dragstart=${t=>this._handleEntityThresholdDragStart(t,n)}
                @dragover=${t=>this._handleEntityThresholdDragOver(t,n)}
                @dragleave=${()=>this._dropThresholdIndex=null}
                @drop=${e=>this._handleEntityThresholdDrop(e,t)}
                @dragend=${()=>{this._draggedThresholdIndex=null,this._dropThresholdIndex=null}}
              >
                <div class="drag-handle">
                  <ha-icon .icon=${"mdi:drag-vertical"}></ha-icon>
                </div>
                <div class="threshold-inputs">
                  <ha-textfield
                    .label=${qo(this.hass,"component.bge.editor.value")}
                    type="number"
                    .value=${String(e.value)}
                    data-field="value"
                    @change=${e=>this._entityThresholdChanged(e,t,n)}
                  ></ha-textfield>
                  <div
                    class="color-input-wrapper"
                    data-picker-id=${`entity_${t}_threshold_${n}`}
                    @mousedown=${e=>this._toggleColorPicker(e,`entity_${t}_threshold_${n}`)}
                  >
                    <ha-textfield
                      .label=${qo(this.hass,"component.bge.editor.color")}
                      .value=${e.color}
                      data-field="color"
                      @change=${e=>this._entityThresholdChanged(e,t,n)}
                    ></ha-textfield>
                    <div class="color-preview" style="background-color: ${e.color}"></div>
                    <div
                      class="color-picker-popup"
                      data-picker-id=${`entity_${t}_threshold_${n}`}
                      @mousedown=${t=>t.stopPropagation()}
                    >
                      <rgb-string-color-picker
                        .color=${e.color}
                        data-field="color"
                        @color-changed=${e=>this._entityThresholdChanged(e,t,n)}
                        alpha
                      ></rgb-string-color-picker>
                    </div>
                  </div>
                </div>
                <ha-icon-button
                  class="remove-icon"
                  .path=${"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}
                  @click=${()=>this._removeEntityThreshold(t,n)}
                ></ha-icon-button>
              </div>
            `)}
        </div>
        <ha-button @click=${()=>this._addEntityThreshold(t)}>
          ${qo(this.hass,"component.bge.editor.add_threshold")}
        </ha-button>
      </div>
    `:q``}render(){return this.hass&&this._config?null!==this._editingIndex?this._renderEntityEditor():this._renderMainConfig():q`<div>Waiting for config…</div>`}_renderMainConfig(){const t=(this._config.color_thresholds?.length??0)>0?"threshold":"single",e=this.hass.themes?.darkMode??!1?"white":"black";return q`
      <div class="card-config">
        <h3>${qo(this.hass,"component.bge.editor.general")}</h3>
        <div class="side-by-side">
          <ha-textfield
            .label=${qo(this.hass,"component.bge.editor.title")}
            .value=${this._config.title||""}
            .configValue=${"title"}
            @change=${this._valueChanged}
          ></ha-textfield>
        </div>

        <h3>${qo(this.hass,"component.bge.editor.graph_appearance")}</h3>
        <div class="side-by-side">
          <ha-textfield
            .label=${qo(this.hass,"component.bge.editor.hours_to_show")}
            type="number"
            .value=${String(this._config.hours_to_show??24)}
            .configValue=${"hours_to_show"}
            @change=${this._valueChanged}
          ></ha-textfield>

          <ha-textfield
            .label=${qo(this.hass,"component.bge.editor.line_width")}
            type="number"
            .value=${String(this._config.line_width??3)}
            .configValue=${"line_width"}
            @change=${this._valueChanged}
          ></ha-textfield>
        </div>

        <div class="side-by-side">
          <ha-select
            .label=${qo(this.hass,"component.bge.editor.line_length")}
            .value=${this._config.line_length||"long"}
            .configValue=${"line_length"}
            @selected=${this._valueChanged}
            @closed=${t=>t.stopPropagation()}
          >
            <mwc-list-item value="long">${qo(this.hass,"component.bge.editor.line_length_long")}</mwc-list-item>
            <mwc-list-item value="short"
              >${qo(this.hass,"component.bge.editor.line_length_short")}</mwc-list-item
            >
          </ha-select>
          <ha-select
            .label=${qo(this.hass,"component.bge.editor.curve")}
            .value=${this._config.curve||"spline"}
            .configValue=${"curve"}
            @selected=${this._valueChanged}
            @closed=${t=>t.stopPropagation()}
          >
            <mwc-list-item value="spline">${qo(this.hass,"component.bge.editor.curve_spline")}</mwc-list-item>
            <mwc-list-item value="linear">${qo(this.hass,"component.bge.editor.curve_linear")}</mwc-list-item>
            <mwc-list-item value="step">${qo(this.hass,"component.bge.editor.curve_step")}</mwc-list-item>
          </ha-select>
        </div>

        <ha-formfield .label=${qo(this.hass,"component.bge.editor.line_glow")}>
          <ha-switch
            .checked=${!0===this._config.line_glow}
            .configValue=${"line_glow"}
            @change=${this._valueChanged}
          ></ha-switch>
        </ha-formfield>

        <div class="opacity-slider-container">
          <div class="label-container">
            <span>${qo(this.hass,"component.bge.editor.line_opacity")}</span>
            <span>${Number(this._config.line_opacity??.2).toFixed(3)}</span>
          </div>
          <ha-slider
            min="0.05"
            max="0.8"
            step="0.025"
            .value=${this._config.line_opacity??.2}
            .configValue=${"line_opacity"}
            @change=${this._valueChanged}
            pin
          ></ha-slider>
        </div>

        <div class="side-by-side">
          <ha-select
            .label=${qo(this.hass,"component.bge.editor.color_mode")}
            .value=${t}
            @selected=${this._handleColorModeChange}
            @closed=${t=>t.stopPropagation()}
          >
            <mwc-list-item value="single"
              >${qo(this.hass,"component.bge.editor.color_mode_single")}</mwc-list-item
            >
            <mwc-list-item value="threshold"
              >${qo(this.hass,"component.bge.editor.color_mode_threshold")}</mwc-list-item
            >
          </ha-select>
        </div>

        ${"single"===t?q`
              <div
                class="color-input-wrapper"
                data-picker-id="line_color"
                @mousedown=${t=>this._toggleColorPicker(t,"line_color")}
              >
                <ha-textfield
                  .label=${qo(this.hass,"component.bge.editor.line_color")}
                  .value=${this._config.line_color||e}
                  .configValue=${"line_color"}
                  @change=${this._valueChanged}
                ></ha-textfield>
                <div
                  class="color-preview"
                  style="background-color: ${this._config.line_color||e}"
                ></div>
                <div
                  class="color-picker-popup"
                  data-picker-id="line_color"
                  @mousedown=${t=>t.stopPropagation()}
                >
                  <rgb-string-color-picker
                    .color=${this._config.line_color||e}
                    .configValue=${"line_color"}
                    @color-changed=${this._colorPicked}
                    alpha
                  ></rgb-string-color-picker>
                </div>
              </div>
            `:q`
              <div>
                <h3>${qo(this.hass,"component.bge.editor.color_thresholds")}</h3>
                <div class="entities-container">
                  ${this._config.color_thresholds.map((t,e)=>q`
                      <div
                        class="entity-container threshold-container ${this._dropThresholdIndex===e?"drag-over":""} ${this._draggedThresholdIndex===e?"dragging":""}"
                        draggable="true"
                        @dragstart=${t=>this._handleThresholdDragStart(t,e)}
                        @dragover=${t=>this._handleThresholdDragOver(t,e)}
                        @dragleave=${()=>this._dropThresholdIndex=null}
                        @drop=${this._handleThresholdDrop}
                        @dragend=${()=>{this._draggedThresholdIndex=null,this._dropThresholdIndex=null}}
                      >
                        <div class="drag-handle">
                          <ha-icon .icon=${"mdi:drag-vertical"}></ha-icon>
                        </div>
                        <div class="threshold-inputs">
                          <ha-textfield
                            .label=${qo(this.hass,"component.bge.editor.value")}
                            type="number"
                            .value=${String(t.value)}
                            data-field="value"
                            @change=${t=>this._thresholdChanged(t,e)}
                          ></ha-textfield>
                          <div
                            class="color-input-wrapper"
                            data-picker-id=${`threshold_${e}`}
                            @mousedown=${t=>this._toggleColorPicker(t,`threshold_${e}`)}
                          >
                            <ha-textfield
                              .label=${qo(this.hass,"component.bge.editor.color")}
                              .value=${t.color}
                              data-field="color"
                              data-index=${String(e)}
                              @change=${t=>this._thresholdChanged(t,e)}
                            ></ha-textfield>
                            <div class="color-preview" style="background-color: ${t.color}"></div>
                            <div
                              class="color-picker-popup"
                              data-picker-id=${`threshold_${e}`}
                              @mousedown=${t=>t.stopPropagation()}
                            >
                              <rgb-string-color-picker
                                .color=${t.color}
                                data-field="color"
                                @color-changed=${t=>this._thresholdChanged(t,e)}
                                alpha
                              ></rgb-string-color-picker>
                            </div>
                          </div>
                        </div>
                        <ha-icon-button
                          class="remove-icon"
                          .path=${"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}
                          @click=${()=>this._removeThreshold(e)}
                        ></ha-icon-button>
                      </div>
                    `)}
                </div>
                <ha-button @click=${this._addThreshold}>
                  ${qo(this.hass,"component.bge.editor.add_threshold")}
                </ha-button>
              </div>
            `}

        <h3>${qo(this.hass,"component.bge.editor.data_settings")}</h3>
        <div class="side-by-side">
          <ha-textfield
            .label=${qo(this.hass,"component.bge.editor.points_per_hour")}
            type="number"
            .value=${String(this._config.points_per_hour??1)}
            .configValue=${"points_per_hour"}
            @change=${this._valueChanged}
          ></ha-textfield>
          <ha-textfield
            .label=${qo(this.hass,"component.bge.editor.update_interval")}
            type="number"
            .value=${String(this._config.update_interval??600)}
            .configValue=${"update_interval"}
            @change=${this._valueChanged}
          ></ha-textfield>
        </div>

        <h3>${qo(this.hass,"component.bge.editor.entities")}</h3>

        <div class="entities-container">
          ${this._config.entities.map((t,e)=>q`
              <div
                class="entity-container ${this._dropIndex===e?"drag-over":""} ${this._draggedIndex===e?"dragging":""}"
                @dragover=${t=>this._handleDragOver(t,e)}
                @dragleave=${this._handleDragLeave}
                @drop=${this._handleDrop}
                @dragend=${this._handleDragEnd}
              >
                <div
                  class="drag-handle"
                  draggable="true"
                  @dragstart=${t=>this._handleDragStart(t,e)}
                >
                  <ha-icon .icon=${"mdi:drag-vertical"}></ha-icon>
                </div>
                <div class="entity-content">
                  <div class="entity-main">
                    <ha-entity-picker
                      .hass=${this.hass}
                      .value=${t.entity}
                      data-index=${e}
                      data-field="entity"
                      @mousedown=${t=>t.stopPropagation()}
                      @value-changed=${this._entityAttributeChanged}
                      allow-custom-entity
                    ></ha-entity-picker>
                    <ha-icon-button
                      class="edit-icon"
                      .path=${"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"}
                      @mousedown=${t=>t.stopPropagation()}
                      @click=${()=>this._editEntity(e)}
                    ></ha-icon-button>
                    <ha-icon-button
                      class="remove-icon"
                      .path=${"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}
                      @mousedown=${t=>t.stopPropagation()}
                      @click=${()=>this._removeEntity(e)}
                    ></ha-icon-button>
                  </div>
                </div>
              </div>
            `)}
        </div>
        <ha-button @click=${this._addEntity}> ${qo(this.hass,"component.bge.editor.add_entity")} </ha-button>
      </div>
    `}static{this.styles=a`
    ${s(Bo)}
  `}};t([dt({attribute:!1})],_s.prototype,"hass",void 0),t([pt()],_s.prototype,"_config",void 0),t([pt()],_s.prototype,"_draggedIndex",void 0),t([pt()],_s.prototype,"_dropIndex",void 0),t([pt()],_s.prototype,"_draggedThresholdIndex",void 0),t([pt()],_s.prototype,"_dropThresholdIndex",void 0),t([pt()],_s.prototype,"_activeColorPicker",void 0),t([pt()],_s.prototype,"_editingIndex",void 0),_s=t([ht("background-graph-entities-editor")],_s);var vs=Object.freeze({__proto__:null,get BackgroundGraphEntitiesEditor(){return _s}});export{Fo as BackgroundGraphEntities};
